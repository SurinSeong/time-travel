#!/usr/bin/env python3
"""
LangGraph íë¦„ì„ ì‹œê°í™”í•˜ëŠ” íŒŒì¼
"""

import os
from dotenv import load_dotenv
from graph_module import make_graph

def visualize_graph():
    """LangGraphì˜ íë¦„ì„ ì‹œê°í™”í•©ë‹ˆë‹¤."""
    
    # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
    load_dotenv()
    
    # ê·¸ë˜í”„ ìƒì„±
    print("ê·¸ë˜í”„ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...")
    graph = make_graph()
    
    print("ê·¸ë˜í”„ ìƒì„± ì™„ë£Œ!")
    print("\n=== LangGraph íë¦„ë„ ===")
    
    # Mermaid í˜•ì‹ìœ¼ë¡œ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
    try:
        from langchain_core.runnables.graph import MermaidDrawMethod
        
        # Mermaid ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
        mermaid_code = graph.get_graph().draw_mermaid()
        print("\nğŸ“Š Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì½”ë“œ:")
        print("=" * 50)
        print(mermaid_code)
        print("=" * 50)
        
        # PNG ì´ë¯¸ì§€ë¡œ ì €ì¥ ì‹œë„
        try:
            png_data = graph.get_graph().draw_mermaid_png(
                draw_method=MermaidDrawMethod.API
            )
            
            # ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥
            with open("graph_flow.png", "wb") as f:
                f.write(png_data)
            print("\nâœ… ê·¸ë˜í”„ ì´ë¯¸ì§€ê°€ 'graph_flow.png'ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")
            
        except Exception as e:
            print(f"\nâš ï¸ PNG ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨: {e}")
            print("Mermaid ì½”ë“œë¥¼ ì˜¨ë¼ì¸ ì—ë””í„°ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”!")
            
    except ImportError:
        print("Mermaid ì‹œê°í™”ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        print("pip install langchain-coreë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.")
        
        # ëŒ€ì•ˆ: í…ìŠ¤íŠ¸ë¡œ ê·¸ë˜í”„ êµ¬ì¡° ì„¤ëª…
        print("\nğŸ“‹ ê·¸ë˜í”„ êµ¬ì¡° ì„¤ëª…:")
        print_graph_structure()

def print_graph_structure():
    """í…ìŠ¤íŠ¸ë¡œ ê·¸ë˜í”„ êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤."""
    print("""
    ğŸ”„ LangGraph ì›Œí¬í”Œë¡œìš° íë¦„:
    
    START
      â†“
    [analyze] â†’ ì§ˆë¬¸ ë¶„ì„ ë…¸ë“œ
      â†“
    [chatbot] â†’ ì±—ë´‡ ì²˜ë¦¬ ë…¸ë“œ
      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           ì¡°ê±´ë¶€ ë¶„ê¸°               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
    â”‚  human  â”‚  tools  â”‚ analyze â”‚ END  â”‚
    â”‚   â†“     â”‚   â†“     â”‚   â†“     â”‚      â”‚
    â”‚ ì¸ê°„ë…¸ë“œ â”‚ ë„êµ¬ë…¸ë“œ â”‚ ë¶„ì„ë…¸ë“œ â”‚ ì¢…ë£Œ  â”‚
    â”‚   â†“     â”‚   â†“     â”‚   â†“     â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
      â†“         â†“         â†“
    [chatbot] [chatbot] [chatbot]
      â†“         â†“         â†“
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
            END
    
    ğŸ“ ë…¸ë“œ ì„¤ëª…:
    
    1. analyze (ì§ˆë¬¸ ë¶„ì„):
       - ì‚¬ìš©ì ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ìœ í˜• ë¶„ë¥˜
       - ê´€ê´‘ì§€, ë§›ì§‘, ì¹´í˜, ë‚ ì”¨ ë“±ìœ¼ë¡œ ë¶„ë¥˜
       - ìœ„ì¹˜ ì •ë³´ ì¶”ì¶œ
    
    2. chatbot (ì±—ë´‡ ì²˜ë¦¬):
       - ì§ˆë¬¸ ë¶„ì„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì ì ˆí•œ ë„êµ¬ ì„ íƒ
       - ì¸ì²œ í† ë°•ì´ ì¹œêµ¬ í˜ë¥´ì†Œë‚˜ë¡œ ì‘ë‹µ
       - ë‹¤ìŒ ë‹¨ê³„ ê²°ì •
    
    3. tools (ë„êµ¬ ì‹¤í–‰):
       - ë²¡í„°DB ê²€ìƒ‰, ì¹´ì¹´ì˜¤ API, ì›¹ ê²€ìƒ‰ ë“±
       - ì‹¤ì œ ì •ë³´ ê²€ìƒ‰ ë° ì²˜ë¦¬
    
    4. human (ì¸ê°„ ê°œì…):
       - ì§ˆë¬¸ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©ìì—ê²Œ ì¶”ê°€ ì§ˆë¬¸
       - ëª…í™•í™”ê°€ í•„ìš”í•œ ê²½ìš° ì²˜ë¦¬
    
    ğŸ”§ ì£¼ìš” ë„êµ¬ë“¤:
    
    â€¢ analyze_user_question: ì§ˆë¬¸ ë¶„ì„ ë° ë¶„ë¥˜
    â€¢ search_spot_tool_in_db: ë²¡í„°DB ê´€ê´‘ì§€ ê²€ìƒ‰
    â€¢ search_tool_in_web: Tavily ì›¹ ê²€ìƒ‰
    â€¢ get_near_restaurant_in_kakao: ì¹´ì¹´ì˜¤ ë§›ì§‘ ê²€ìƒ‰
    â€¢ get_near_cafe_in_kakao: ì¹´ì¹´ì˜¤ ì¹´í˜ ê²€ìƒ‰
    â€¢ search_blog: ì¹´ì¹´ì˜¤ ë¸”ë¡œê·¸ ê²€ìƒ‰
    â€¢ get_detail_info: ë¸”ë¡œê·¸ ë‚´ìš© í¬ë¡¤ë§
    â€¢ ask_for_clarification: ì§ˆë¬¸ ëª…í™•í™” ìš”ì²­
    
    ğŸ’¬ ëŒ€í™” íë¦„:
    
    ì‚¬ìš©ì ì§ˆë¬¸ â†’ ì§ˆë¬¸ ë¶„ì„ â†’ ì±—ë´‡ ì²˜ë¦¬ â†’ ë„êµ¬ ì„ íƒ â†’ 
    ì •ë³´ ê²€ìƒ‰ â†’ ì‘ë‹µ ìƒì„± â†’ ë‹¤ìŒ ë‹¨ê³„ ê²°ì • â†’ ë°˜ë³µ ë˜ëŠ” ì¢…ë£Œ
    """)

if __name__ == "__main__":
    visualize_graph()
